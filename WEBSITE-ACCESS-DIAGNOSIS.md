# www.zjsifan.com ç½‘ç«™è®¿é—®é—®é¢˜è¯Šæ–­æŠ¥å‘Š

## é—®é¢˜æ¦‚è¿°

**ç”¨æˆ·åé¦ˆ**ï¼šwww.zjsifan.com æ— æ³•æ­£å¸¸è®¿é—®ç½‘ç«™

**è¯Šæ–­æ—¶é—´**ï¼š2026-01-10

**é—®é¢˜ä¸¥é‡ç¨‹åº¦**ï¼šğŸ”´ é«˜ï¼ˆç½‘ç«™æ— æ³•è®¿é—®ï¼‰

---

## è¯Šæ–­ç»“æœ

### âœ… æ­£å¸¸é¡¹ç›®

1. **DNSåŸŸåè§£æ**
   - âœ… åŸŸåæ­£ç¡®è§£æåˆ°æœåŠ¡å™¨IP
   - è§£æç»“æœï¼šwww.zjsifan.com â†’ 42.121.218.14
   - DNSé…ç½®æ­£ç¡®

2. **åŸŸåå¯è®¿é—®æ€§**
   - âœ… åŸŸåå¯ä»¥è®¿é—®ï¼ˆHTTP 200ï¼‰
   - 80ç«¯å£å¯ä»¥ä»å¤–ç½‘è®¿é—®
   - é˜¿é‡Œäº‘å®‰å…¨ç»„å·²å¼€æ”¾80ç«¯å£

### âŒ å‘ç°çš„é—®é¢˜

#### é—®é¢˜1ï¼šApache HTTP Server å ç”¨80ç«¯å£ ğŸ”´

**ç°è±¡**ï¼š
- è®¿é—® http://www.zjsifan.com è¿”å› Apache é»˜è®¤æµ‹è¯•é¡µé¢
- é¡µé¢å†…å®¹ï¼š`Welcome to HTTP Server Test Page!`
- æœåŠ¡å™¨æ ‡è¯†ï¼š`Server: nginx/1.20.1`ï¼ˆå®é™…æ˜¯Apacheä»£ç†æˆ–é…ç½®é”™è¯¯ï¼‰

**åŸå› **ï¼š
- Apache HTTP Server å ç”¨äº†80ç«¯å£
- Nginx æ— æ³•ç»‘å®š80ç«¯å£
- è¯·æ±‚è¢«Apacheå¤„ç†ï¼Œè¿”å›é»˜è®¤æµ‹è¯•é¡µé¢

**å½±å“**ï¼š
- âŒ ç”¨æˆ·è®¿é—®åŸŸåçœ‹åˆ°çš„æ˜¯Apacheæµ‹è¯•é¡µé¢
- âŒ æ— æ³•è®¿é—®Next.jsåº”ç”¨
- âŒ ç½‘ç«™åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨

#### é—®é¢˜2ï¼šNginxé…ç½®é”™è¯¯ ğŸ”´

**ç°è±¡**ï¼š
- Nginxé…ç½®çš„ proxy_pass æŒ‡å‘é”™è¯¯ç«¯å£
- å½“å‰é…ç½®ï¼š`proxy_pass http://localhost:3000;`
- å®é™…Next.jsè¿è¡Œç«¯å£ï¼š5000

**åŸå› **ï¼š
- å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒé…ç½®ä¸ä¸€è‡´
- é…ç½®æ–‡ä»¶æœªæ­£ç¡®æ›´æ–°

#### é—®é¢˜3ï¼šç«¯å£å†²çª ğŸ”´

**ç°è±¡**ï¼š
- Apacheç›‘å¬80ç«¯å£
- Nginxæ— æ³•æ­£å¸¸å¯åŠ¨æˆ–å·¥ä½œ
- åªæœ‰Apacheåœ¨å¤„ç†HTTPè¯·æ±‚

---

## æ ¹æœ¬åŸå› 

**æ ¸å¿ƒé—®é¢˜**ï¼šApache HTTP Server å ç”¨äº†80ç«¯å£ï¼Œå¯¼è‡´Nginxæ— æ³•æ­£å¸¸å·¥ä½œï¼Œä»è€Œæ— æ³•å°†è¯·æ±‚è½¬å‘åˆ°Next.jsåº”ç”¨ã€‚

**æ¶æ„é—®é¢˜**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ 80ç«¯å£ â†’ Apache (é»˜è®¤æµ‹è¯•é¡µé¢)
                â†“
            âŒ æ— æ³•åˆ°è¾¾ Nginx â†’ Next.js (5000ç«¯å£)
```

**é¢„æœŸæ¶æ„**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ 80ç«¯å£ â†’ Nginx â†’ Next.js (5000ç«¯å£)
                           â†“
                       æ­£å¸¸ç½‘ç«™å†…å®¹
```

---

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨ä¿®å¤è„šæœ¬ï¼ˆæ¨èï¼‰ âœ…

**æ­¥éª¤**ï¼š
1. ä¸Šä¼ è„šæœ¬åˆ°æœåŠ¡å™¨
2. æ‰§è¡Œä¿®å¤è„šæœ¬
3. éªŒè¯ç½‘ç«™è®¿é—®

**æ‰§è¡Œå‘½ä»¤**ï¼š
```bash
# ç™»å½•æœåŠ¡å™¨
ssh root@42.121.218.14

# ä¸‹è½½è„šæœ¬ï¼ˆæˆ–ä»GitHubè·å–ï¼‰
wget https://raw.githubusercontent.com/MFCR7788/sifan/main/fix-apache-nginx-conflict.sh

# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x fix-apache-nginx-conflict.sh

# æ‰§è¡Œä¿®å¤
sudo ./fix-apache-nginx-conflict.sh
```

**è„šæœ¬åŠŸèƒ½**ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹Apacheå’ŒNginxçŠ¶æ€
- âœ… åœæ­¢ApacheæœåŠ¡å¹¶ç¦ç”¨å¼€æœºå¯åŠ¨
- âœ… æ£€æµ‹Next.jsè¿è¡Œç«¯å£ï¼ˆ3000æˆ–5000ï¼‰
- âœ… æ›´æ–°Nginxé…ç½®
- âœ… å¯åŠ¨NginxæœåŠ¡
- âœ… éªŒè¯ä¿®å¤ç»“æœ

### æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨ä¿®å¤

å¦‚æœè„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

#### æ­¥éª¤1ï¼šåœæ­¢Apache

```bash
# æ£€æŸ¥ApacheçŠ¶æ€
service httpd status
# æˆ–
systemctl status httpd

# åœæ­¢Apache
systemctl stop httpd
service httpd stop

# ç¦ç”¨Apacheå¼€æœºå¯åŠ¨
systemctl disable httpd
chkconfig httpd off

# ç¡®è®¤Apacheå·²åœæ­¢
ps aux | grep httpd
ss -tuln | grep :80
```

#### æ­¥éª¤2ï¼šæ£€æŸ¥Next.jsç«¯å£

```bash
# æ£€æŸ¥Next.jsè¿è¡Œç«¯å£
ss -tuln | grep -E ':(3000|5000)'

# æ£€æŸ¥Next.jsè¿›ç¨‹
ps aux | grep next
```

#### æ­¥éª¤3ï¼šæ›´æ–°Nginxé…ç½®

```bash
# ç¼–è¾‘Nginxé…ç½®
nano /etc/nginx/sites-available/zjsifan.com
# æˆ–
vim /etc/nginx/sites-available/zjsifan.com
```

**é…ç½®å†…å®¹**ï¼ˆå‡è®¾Next.jsè¿è¡Œåœ¨5000ç«¯å£ï¼‰ï¼š
```nginx
server {
    listen 80;
    server_name zjsifan.com www.zjsifan.com;

    location / {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

#### æ­¥éª¤4ï¼šå¯åŠ¨Nginx

```bash
# æµ‹è¯•Nginxé…ç½®
nginx -t

# å¯åŠ¨Nginx
systemctl start nginx
service nginx start

# å¯ç”¨Nginxå¼€æœºå¯åŠ¨
systemctl enable nginx
chkconfig nginx on

# æ£€æŸ¥NginxçŠ¶æ€
systemctl status nginx
ss -tuln | grep :80
```

#### æ­¥éª¤5ï¼šéªŒè¯ä¿®å¤

```bash
# æœ¬åœ°æµ‹è¯•
curl -I http://localhost
curl http://localhost | head -20

# åŸŸåæµ‹è¯•
curl -I http://www.zjsifan.com
curl http://www.zjsifan.com | head -20
```

---

## éªŒè¯æ¸…å•

ä¿®å¤å®Œæˆåï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] Apacheå·²åœæ­¢ï¼ˆ`ps aux | grep httpd` æ— è¾“å‡ºï¼‰
- [ ] Nginxæ­£åœ¨è¿è¡Œï¼ˆ`ps aux | grep nginx` æœ‰è¾“å‡ºï¼‰
- [ ] 80ç«¯å£è¢«Nginxå ç”¨ï¼ˆ`ss -tuln | grep :80`ï¼‰
- [ ] Next.jsæ­£åœ¨è¿è¡Œï¼ˆ`ss -tuln | grep :5000`ï¼‰
- [ ] è®¿é—® http://www.zjsifan.com æ˜¾ç¤ºæ­£å¸¸ç½‘ç«™å†…å®¹
- [ ] è®¿é—® http://42.121.218.14 æ˜¾ç¤ºæ­£å¸¸ç½‘ç«™å†…å®¹
- [ ] ä¸å†æ˜¾ç¤ºApacheæµ‹è¯•é¡µé¢

---

## å¸¸è§é—®é¢˜

### Q1: åœæ­¢Apacheåï¼Œå®ƒåˆè‡ªåŠ¨å¯åŠ¨äº†æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥å¼€æœºå¯åŠ¨é¡¹ï¼š
```bash
# systemdç³»ç»Ÿ
systemctl disable httpd
systemctl disable apache2

# ä¼ ç»Ÿç³»ç»Ÿ
chkconfig httpd off
update-rc.d -f apache2 remove
```

### Q2: Nginxå¯åŠ¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥é…ç½®å’Œæ—¥å¿—ï¼š
```bash
# æµ‹è¯•é…ç½®
nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log

# æ£€æŸ¥ç«¯å£å ç”¨
ss -tuln | grep :80
```

### Q3: Next.jsåº”ç”¨æ— æ³•å¯åŠ¨æ€ä¹ˆåŠï¼Ÿ

**A**: å¯åŠ¨Next.jsï¼š
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /workspace/projects  # æˆ–æ‚¨çš„é¡¹ç›®è·¯å¾„

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
pnpm install

# å¯åŠ¨å¼€å‘æ¨¡å¼
pnpm run dev

# æˆ–ä½¿ç”¨PM2ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
pm2 start "pnpm run dev" --name "nextjs"
pm2 save
pm2 startup
```

### Q4: ä¿®å¤åä»ç„¶æ˜¾ç¤ºApacheé¡µé¢ï¼Ÿ

**A**: å¯èƒ½åŸå› ï¼š
1. Apacheä»åœ¨è¿è¡Œ â†’ å†æ¬¡åœæ­¢
2. æµè§ˆå™¨ç¼“å­˜ â†’ æ¸…é™¤ç¼“å­˜æˆ–ä½¿ç”¨éšç§æ¨¡å¼
3. CDNç¼“å­˜ â†’ ç­‰å¾…åˆ·æ–°æˆ–æ‰‹åŠ¨æ¸…é™¤
4. Nginxé…ç½®é”™è¯¯ â†’ æ£€æŸ¥é…ç½®æ–‡ä»¶

---

## é•¿æœŸè§£å†³æ–¹æ¡ˆ

### 1. ç§»é™¤Apacheï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸éœ€è¦Apacheï¼Œå¯ä»¥å½»åº•ç§»é™¤ï¼š

```bash
# CentOS/RHEL
yum remove httpd

# Ubuntu/Debian
apt-get remove apache2
```

### 2. ä½¿ç”¨PM2ç®¡ç†Next.jsï¼ˆæ¨èï¼‰

```bash
# å®‰è£…PM2
npm install -g pm2

# å¯åŠ¨åº”ç”¨
pm2 start "pnpm run dev" --name "nextjs"

# ä¿å­˜è¿›ç¨‹åˆ—è¡¨
pm2 save

# è®¾ç½®å¼€æœºå¯åŠ¨
pm2 startup
```

### 3. é…ç½®HTTPS

æŒ‰ç…§ `HTTPS-SETUP-GUIDE.md` é…ç½®Let's Encryptå…è´¹SSLè¯ä¹¦ã€‚

### 4. ç›‘æ§æœåŠ¡

```bash
# æŸ¥çœ‹NginxçŠ¶æ€
systemctl status nginx

# æŸ¥çœ‹Next.jsçŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

---

## è„šæœ¬æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| `fix-apache-nginx-conflict.sh` | è‡ªåŠ¨ä¿®å¤Apacheå’ŒNginxç«¯å£å†²çª |
| `diagnose-website-access.sh` | ç½‘ç«™è®¿é—®è¯Šæ–­å·¥å…· |
| `fix-nginx-port.sh` | ä¿®å¤Nginxç«¯å£é…ç½® |
| `setup-https-letsencrypt.sh` | é…ç½®HTTPSï¼ˆä¿®å¤åæ‰§è¡Œï¼‰ |

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. è¯Šæ–­è„šæœ¬è¾“å‡ºï¼š`bash diagnose-website-access.sh`
2. é”™è¯¯æ—¥å¿—ï¼š
   ```bash
   tail -50 /var/log/nginx/error.log
   pm2 logs nextjs --lines 50
   ```
3. æœåŠ¡çŠ¶æ€ï¼š
   ```bash
   ss -tuln | grep -E ':(80|3000|5000)'
   ps aux | grep -E 'nginx|httpd|next'
   ```

---

## ç›¸å…³æ–‡æ¡£

- `HTTPS-SETUP-GUIDE.md` - HTTPSé…ç½®æŒ‡å—
- `PORT-600-GUIDE.md` - ç«¯å£é…ç½®æŒ‡å—
- `DEPLOYMENT.md` - éƒ¨ç½²æ–‡æ¡£

---

**æœ€åæ›´æ–°**ï¼š2026-01-10
**ç‰ˆæœ¬**ï¼š1.0
