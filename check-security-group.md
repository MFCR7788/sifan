# 阿里云安全组检查清单

## 问题现象
- ✅ 服务器内部：`curl http://www.zjsifan.com` 返回 HTTP 200
- ❌ 外部访问：浏览器显示 `ERR_CONNECTION_CLOSED`

## 根本原因
阿里云安全组的**入方向规则**没有真正开放80端口。

## 检查步骤（重要）

### 1. 登录阿里云控制台
https://ecs.console.aliyun.com

### 2. 找到正确实例
确保你找到的实例ID是：`iZbp1iylcenpqgx9u0t6mpZ`

### 3. 检查安全组配置

#### 方法A：通过实例检查
1. 点击实例ID进入详情页
2. 点击左侧菜单"安全组"
3. 查看绑定的安全组列表
4. 点击安全组ID进入详情
5. 点击"配置规则"

#### 方法B：通过安全组列表
1. 左侧菜单选择"安全组"
2. 找到绑定的安全组
3. 点击"配置规则"

### 4. 检查入方向规则

**必须存在的规则：**

| 规则方向 | 授权策略 | 协议类型 | 端口范围 | 授权对象 | 优先级 |
|---------|---------|---------|---------|---------|-------|
| 入方向 | 允许 | 自定义TCP | 80/80 | 0.0.0.0/0 | 1 |

**注意：**
- ✅ 端口必须是 `80/80`，不是 `1/65535`
- ✅ 授权对象必须是 `0.0.0.0/0`（允许所有IP）
- ✅ 协议类型必须是 `自定义TCP` 或 `TCP`
- ✅ 授权策略必须是 `允许`

### 5. 如果规则不存在

点击"添加规则" → "手动添加"，填写：

- **规则方向**：入方向
- **授权策略**：允许
- **协议类型**：自定义TCP
- **端口范围**：80/80
- **授权对象**：0.0.0.0/0
- **优先级**：1
- **描述**：HTTP

点击"确定"保存。

### 6. 验证规则添加成功

检查规则列表中是否出现了刚才添加的规则。

### 7. 立即生效

阿里云安全组规则修改后**立即生效**，无需重启。

### 8. 再次测试

从本地浏览器访问：
- http://www.zjsifan.com

## 常见错误

### 错误1：端口范围写错了
❌ 错误：`1/65535` 或 `8000/9000`
✅ 正确：`80/80`

### 错误2：授权对象写错了
❌ 错误：`0.0.0.0/0/0` 或 `127.0.0.1`
✅ 正确：`0.0.0.0/0`

### 错误3：改错安全组了
绑定了多个安全组，但只修改了其中一个，确保所有绑定的安全组都有80端口规则。

### 错误4：实例ID搞错了
确保修改的是 `iZbp1iylcenpqgx9u0t6mpZ` 这个实例的安全组。

## 快速检查命令（在本地电脑）

```bash
# 检查80端口是否开放
nc -zv 42.121.218.14 80

# 或使用telnet
telnet 42.121.218.14 80

# 如果显示 Connected to 42.121.218.14，说明端口开放
# 如果显示 Connection refused，说明端口未开放
```

## 端口状态说明

| 测试结果 | 说明 | 解决方案 |
|---------|------|---------|
| Connected | 端口开放 | 检查DNS解析 |
| Connection refused | 端口未开放 | 修改安全组 |
| Connection timed out | 网络不通 | 检查IP是否正确 |

## 如果还是不行

### 检查公网IP
```bash
# 在服务器上执行
curl ifconfig.me
# 应该返回 42.121.218.14
```

### 检查Nginx监听
```bash
# 在服务器上执行
sudo netstat -tlnp | grep :80
# 应该看到 nginx 监听 0.0.0.0:80
```

### 联系阿里云客服
如果以上都正确但仍然无法访问，可能是运营商限制或其他问题，建议：
1. 提交阿里云工单
2. 提供实例ID：iZbp1iylcenpqgx9u0t6mpZ
3. 说明问题：安全组已开放80端口，但外部无法访问
