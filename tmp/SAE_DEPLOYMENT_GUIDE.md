# 阿里云 SAE 部署指南

## 快速部署步骤

### 1. 登录阿里云 SAE 控制台

访问：https://sae.console.aliyun.com/

### 2. 创建命名空间（可选）

如果还没有命名空间：
1. 点击左侧菜单 "命名空间"
2. 点击 "创建命名空间"
3. 填写信息：
   - 名称：如 `sifan-production`
   - 描述：随意
4. 点击确定

### 3. 创建应用

1. 点击左侧菜单 "应用管理" → "应用列表"
2. 点击右上角 "创建应用"
3. 选择应用类型：
   - **Web 应用**
4. 填写基本信息：
   - **应用名称**：`sifan-website`
   - **应用描述**：思梵企业官网
   - **命名空间**：选择刚创建的或默认命名空间
5. 点击 "下一步"

### 4. 配置应用部署

#### 4.1 部署方式
选择 **"代码包部署"** → **"从代码仓库"**

#### 4.2 代码仓库
- **代码仓库类型**：GitHub
- **授权**：点击授权并选择你的 GitHub 账户
- **仓库**：选择 `MFCR7788/sifan`
- **分支**：`main`

#### 4.3 构建配置
填写以下信息：

```
技术栈：Node.js
运行环境：Node.js 20.x（或最新 LTS 版本）
构建命令：npm install && npm run build
启动命令：npm start
端口号：3000
```

#### 4.4 环境变量配置
在 "环境变量" 部分添加以下配置：

```env
NODE_ENV=production
```

#### 4.5 容器配置
选择合适的配置：
- **CPU**：0.5 Core（免费/低配）或 1 Core
- **内存**：1GB（免费/低配）或 2GB
- **实例数**：1

### 5. 应用配置

#### 5.1 健康检查
- **检查方式**：HTTP
- **检查路径**：/
- **检查频率**：30 秒
- **超时时间**：5 秒

#### 5.2 超时设置
- **请求超时时间**：60 秒

### 6. 创建并部署

1. 点击 "创建应用"
2. 等待应用创建成功
3. 系统会自动触发构建和部署
4. 构建过程包括：
   - 拉取代码
   - 安装依赖（npm install）
   - 构建项目（npm run build）
   - 启动应用（npm start）

### 7. 访问应用

构建和部署完成后：
1. 在应用详情页找到 "应用访问地址"
2. 点击访问链接
3. 首次访问可能需要等待 30-60 秒

---

## 常见问题

### Q1: 构建失败，提示 "npm install" 错误
**解决方案：**
- 检查 Node.js 版本是否匹配（建议使用 20.x）
- 检查 package.json 中的依赖是否完整

### Q2: 构建成功但访问 502/504 错误
**解决方案：**
- 检查启动命令是否正确（应该是 `npm start`）
- 检查端口号是否为 3000（Next.js 默认端口）
- 查看应用日志排查问题

### Q3: 数据库连接失败
**解决方案：**
- 需要配置数据库环境变量
- 在阿里云 RDS 创建 PostgreSQL 数据库
- 在 SAE 应用中添加数据库连接配置：
```env
DATABASE_URL=postgresql://用户名:密码@数据库地址:端口/数据库名
```

### Q4: 构建时间过长
**解决方案：**
- 增加容器内存配置（2GB 更快）
- 优化 package.json，移除不必要的依赖

---

## 费用说明

### 免费额度（新用户）
- CPU：400 vCPU·小时/月
- 内存：800 GB·小时/月

### 付费方案
- 0.5 Core + 1GB：约 ¥0.045/小时
- 1 Core + 2GB：约 ¥0.09/小时
- 月费用约：¥30-65（取决于使用时长）

---

## 高级配置（可选）

### 启用自定义域名
1. 在应用详情页 → "基础设置"
2. 点击 "添加域名"
3. 输入你的域名（如 www.sifan.com）
4. 配置 DNS 解析到 SAE 提供的 CNAME

### 启用日志服务
1. 在应用详情页 → "日志管理"
2. 开通 SLS 日志服务
3. 可查看应用运行日志、访问日志等

### 启用监控告警
1. 在应用详情页 → "监控"
2. 配置 CPU、内存、响应时间等指标
3. 设置告警规则和通知方式

---

## 持续部署

一旦配置完成，后续的代码推送会自动触发部署：
1. 在本地修改代码
2. git commit 并 push 到 GitHub
3. SAE 自动检测到新提交
4. 自动触发构建和部署
5. 部署完成后自动切换流量

---

## 技术支持

如遇到问题：
1. 查看应用日志（SAE 控制台 → 日志）
2. 查看构建日志（构建历史）
3. 阿里云官方文档：https://help.aliyun.com/product/60361.html
4. 阿里云工单系统

---

## 项目结构

```
sifan/
├── src/
│   ├── app/              # Next.js App Router
│   ├── components/       # React 组件
│   └── lib/             # 工具函数
├── public/              # 静态资源
├── package.json         # 依赖配置
├── tsconfig.json        # TypeScript 配置
└── next.config.js       # Next.js 配置
```

---

**部署完成后，访问地址格式：**
`http://<应用ID>.<区域>.sae.aliyun.com`

祝部署顺利！
